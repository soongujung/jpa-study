# 엔티티 매핑이란?



# 참고자료

[자바 ORM 표준 JPA 프로그래밍](http://www.yes24.com/Product/Goods/19040233?OzSrank=4)

  

# 엔티티 매핑시 테이블과 객체의 차이점

- 테이블은 외래키 하나로 조인을 사용해서 양방향으로 쿼리가 가능하다. 따라서 사실상 방향이라는 개념이 없다. (5장에 밑줄 친것 중에 이것보다 간단한 내용이 있다. 은근 중복된 내용이 많다. 추려내기)
- 객체는 참조용 필드를 가진 객체일 경우에만 참조를 걸어놓은 연관된 객체를 조회할 수 있다.

  

# 엔티티 연관관계 매핑시 고려사항 3가지

- 매핑관계

- - OneToMany, ManyToOne, OneToOne, ManyToMany
  - 책에서는 '다중성'이라고 정의 (다중이라는 단어가 자꾸 떠올라서 개념이 와닿지 않아서 그냥 매핑관계로 정함)

- 단방향/양방향

- 연관관계의 주인

  

# 매핑관계

- OneToMany, ManyToOne, OneToOne, ManyToMany 등이 존재.

- 매핑 관계를 파악하기 어려운 경우가 있을 수 있다. 이 경우 반대 방향입장으로 돌아봐서 생각해보면 된다. 

  - (ex. ManyToOne 의 반대방향은 OneToMany 이고 OneToOne의 반대방향은 OneToOne)

- 실무에서는 ManyToOne, OneToMany 관계가 가장 많이 쓰인다.

- ManyToMany를 쓸정도로 복잡한 매핑은 거의 없다.

- OOOToXXX 에서 OOO 와 같이 To의 앞에 붙은 OOO 가 프로그램 내에서 외래키를 소유하고 관리하는 역할을 한다.

- - DB에서의 물리적인 관리가 아닌 프로그램 계층에서의 외래키 관리를 의미
  - 프로그램 입장(앱 계층)에서의 관리하는 것을 의미. 테이블, DBMS에서는 테이블이 외래키를 소유하고 관리한다는 개념이 있는지는 잘 모르겠어서 개념정리할 때 굉장히 조심스럽기는 하다.
  - 개인적인 의견이지만, 프로그래머가 의미를 부여해 외래키를 이용해서 테이블간의 조인을 하기 전까지는 단순히 하드디스크 상의 비트 조각일 뿐이지 않을까 싶기도 하다.

- 책에서는 주인 테이블을 이야기하고 있는데, 이 부분에 대해서는 생략하고 모든 내용을 정리할 예정이다. (Database 이론을 모르는 개발자입장에서는 주인 테이블이라는 용어를 써서 정리하는 것이 조금 조심스럽기는 하다.)



# 단방향/양방향

- 단방향 매핑은 연관관계의 주인이 될 엔티티 클래스를 지정하고, 반대편에 해당하는 엔티티 클래스에 대해서는 부가적인 작업을하지 않는다.
- 양방향 매핑은 연관관계의 주인이 될 엔티티 클래스를 지정하고, 반대편에 매핑될 엔티티 클래스를 지정해서 매핑한다.



# 연관관계의 주인

- 외래키가 위치한 테이블을 표현한 엔티티 클래스. 

- 연관관계의 주인이라는 것은 JPA 에서 존재하는 개념.

- JPA 는 두 객체 연관관계 중 객체 하나를 선택해서 프로그램 계층에서 사용할 데이터베이스 외래키를 관리하는데 이 것을 **연관관계의 주인**이라고 한다.

- 연관관계의 주인 반대편인, 상대편 객체에서는 mappedBy를 통해 매핑을 당한다.

- 연관관계의 주인 측을 선택할 때 외래키 관리자 역할을 부여하는 용도로 접근해서 선택해야 한다. 

- - 관리자 라는 의미는 애플리케이션 계층에서의 관리자를 의미한다. 데이터베이스 개념에서는 외래키 관리자의 개념이 어떤것인지는 잘 모르겠다.
  - 실제로 프로그램 상에서는 외래키에 대해서 mappedBy 되는 필드를 직접 관리하는 코드를 작성하기 때문이다.

- 외래키를 가진 테이블과 매핑한 엔티티가 외래키를 관리하는 것이 효율적이기 때문에 보통 이곳을 연관관계의 주인으로 선택한다. 



# 연관관계 매핑 종류별 단방향/양방향 가능 여부

연관관계 매핑 종류별로 단방향/양방향 가능 여부를 정리해보면 아래와 같다.

- ManyToOne : 단방향, 양방향
- OneToMany : 단방향, 양방향
- OneToOne : 주인 테이블 단방향, 양방향
- OneToOne : 대상 테이블 단방향, 양방향
- ManyToOne : 단방향, 양방향



# 연관관계 헬퍼 메서드

> [자바 ORM 표준 JPA 프로그래밍](http://www.yes24.com/Product/Goods/19040233?OzSrank=4) 에서는 **연관관계 편의 메서드** 라고 저자분께서 정의해주신다. 개인적으로 한국어 번역 용어를 항상 낯설게 느껴와서 헬퍼 메서드로 용어를 바꾸어 지정할 예정이다. (개인적으로 공부할때 매번 편의메서드가 뭐였지? 하고 헷갈려서 따로 바꾸어 지정함.)



